// Generated by CoffeeScript 1.9.1
(function() {
  var FastBricks, cson, mysql, sql;

  mysql = require('mysql');

  cson = require('cson');

  sql = require('mssql');

  FastBricks = (function() {
    function FastBricks() {}

    FastBricks.prototype.loadConfig = function(filename) {
      this.config = cson.parseCSONFile(filename);
      if (this.config.driver_type === 'mysql') {
        return this.pool = mysql.createPool(this.config);
      }
    };

    FastBricks.prototype.query = function(b, c) {
      if (this.config.driver_type === 'mysql') {
        this.queryMySQL(b, c);
      }
      if (this.config.driver_type === 'sqlserver') {
        return this.querySQLServer(b, c);
      }
    };

    FastBricks.prototype.queryMySQL = function(bricksExpr, callback) {
      var d;
      d = bricksExpr.toParams({
        placeholder: "?"
      });
      if (bricksExpr.log) {
        console.log(d.text);
        console.log(d.values);
      }
      return this.pool.query(d.text, d.values, function(err, res) {
        if (err) {
          console.log(err);
        }
        return callback(err, res);
      });
    };

    FastBricks.prototype.querySQLServer = function(bricksExpr, callback) {
      var connection, expr;
      expr = bricksExpr.toString();
      if (bricksExpr.log) {
        console.log(expr);
      }
      connection = new sql.Connection(this.config);
      return connection.connect(function(err) {
        var request;
        if (err) {
          console.log(err);
        }
        request = connection.request();
        return request.query(expr, function(err, recordset) {
          connection.close();
          return callback(err, recordset);
        });
      });
    };

    return FastBricks;

  })();

  module.exports = FastBricks;

}).call(this);
